{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}
{% set important_links = theme.settings.get('important_links') %}
<header class="store-header">
  {# Top Nav #}
  <div class="top-navbar text-white" style="background-color: #3C3C3C;">
    <div class="container flex justify-between items-center py-2">
     

      {# Left side - Search and Profile #}
      <div class="flex items-center gap-3">
          {# Search icon #}
          <button class="text-white hover:text-gray-300" aria-label="search-icon" onclick="salla.event.dispatch('search::open')">
            <i class="sicon-search text-lg"></i>
          </button>
          <salla-search-modal></salla-search-modal>
          
          {# Profile icon #}
          {% if user.type=='user' %}
            <salla-user-menu avatar-only show-header class="text-white"></salla-user-menu>
          {% else %}
              <button class="text-white hover:text-gray-300" aria-label="user-icon" onclick="salla.event.dispatch('login::open')">
                <i class="sicon-user-circle text-lg"></i>
              </button>
          {% endif %}
      </div>
      {# Center - Logo #}
      <div class="flex-1 flex justify-center">
          <a class="navbar-brand" href="{{ store.url }}">
              <img fetchpriority="high" width="100%" height="100%" loading="eager" src="{{ store.logo }}" alt="{{ store.name }} logo" class="max-h-8">
              {% if is_page('index') %}
                <h1 class="sr-only">{{ store.name }}</h1>
              {% else %}
                <h2 class="sr-only">{{ store.name }}</h2>
              {% endif %}
          </a>
      </div>
       {# Right side - Language #}
      <div class="flex items-center">
              {% if store.settings.is_multilingual or store.settings.currencies_enabled %}
              <div class="relative">
                  <button type="button" id="language-dropdown-btn" class="text-white text-sm hover:text-gray-300 flex items-center py-1 px-2 rounded">
                      <span class="flag iti__flag iti__{{ user.language.country_code }} rounded-sm ltr:mr-1 rtl:ml-1"></span>
                      {{ user.language.name }}
                  </button>
                  
                  <div id="language-dropdown" class="absolute top-full ltr:right-0 rtl:left-0 mt-1 w-40 rounded-md shadow-xl border border-gray-400 z-[9999] hidden" style="background-color: #3c3c3c;">
                      <div class="py-1">
                          <a href="#" onclick="changeLanguage('en')" class="flex items-center justify-between px-3 py-2 text-sm text-white hover:bg-gray-600 transition-colors duration-150">
                              <div class="flex items-center">
                                  <span class="flag iti__flag iti__us rounded-sm ltr:mr-2 rtl:ml-2"></span>
                                  <span>English</span>
                              </div>
                              <span class="text-gray-300 text-xs">EN</span>
                          </a>
                          <a href="#" onclick="changeLanguage('ar')" class="flex items-center justify-between px-3 py-2 text-sm text-white hover:bg-gray-600 transition-colors duration-150">
                              <div class="flex items-center">
                                  <span class="flag iti__flag iti__sa rounded-sm ltr:mr-2 rtl:ml-2"></span>
                                  <span>العربية</span>
                              </div>
                              <span class="text-gray-300 text-xs">AR</span>
                          </a>
                      </div>
                  </div>
          </div>
          {% endif %}
      </div>
    </div>
  </div>

  {# Main Nav #}
  <div id="mainnav" class="main-nav-container shadow-default bg-black">
      <div class="inner bg-inherit">
          <div class="container">
              <div class="flex items-stretch justify-center relative">
                  <div class="flex items-center">
                      <a class="lg:hidden mburger mburger--collapse leading-none rtl:ml-4 ltr:mr-4" href="#mobile-menu" aria-label="Open-menu">
                        <i class="sicon-menu text-primary text-2xl"></i>
                      </a>
                     
                      <custom-main-menu></custom-main-menu>
                  </div>
                  
              </div>
          </div>
      </div>
  </div>
</header>
{% if store.scope %}
    <salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}

<script>
// Language dropdown functionality
document.addEventListener('DOMContentLoaded', function() {
    const dropdownBtn = document.getElementById('language-dropdown-btn');
    const dropdown = document.getElementById('language-dropdown');
    
    if (dropdownBtn && dropdown) {
        // Toggle dropdown on button click
        dropdownBtn.addEventListener('click', function(e) {
            e.preventDefault();
            dropdown.classList.toggle('hidden');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!dropdownBtn.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.add('hidden');
            }
        });
        
        // Close dropdown on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                dropdown.classList.add('hidden');
            }
        });
    }
});

function changeLanguage(languageCode) {
    // Use Salla's language change API
    if (window.salla && window.salla.language) {
        window.salla.language.change(languageCode);
    } else {
        // Fallback: redirect to the language-specific URL
        const currentUrl = window.location.href;
        const baseUrl = currentUrl.split('?')[0];
        window.location.href = baseUrl + '?lang=' + languageCode;
    }
    
    // Close dropdown
    document.getElementById('language-dropdown').classList.add('hidden');
}
</script>
