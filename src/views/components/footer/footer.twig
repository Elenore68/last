<footer class="footer bg-[#1a1a1a] text-white" dir="ltr">
  <!-- Newsletter Section -->
  <section 
    class="py-8 md:py-6 sm:py-4 bg-cover bg-center bg-no-repeat relative min-h-screen"
    style="
      background-image: url('{{ 'images/footerBG.png'|asset }}');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 80vh;
    "
  >
    <div class="max-w-[1200px] mx-auto px-5 h-full flex items-center" style="padding-top: 60px;">
      <div class="text-center max-w-[500px] ml-auto">
        <div class="mb-2">
          <img 
            src="{{ 'images/footerlogo.png'|asset }}" 
            alt="Alcanta" 
            class="h-12 md:h-14 sm:h-10 mx-auto"
            style="max-height: 56px;"
          />
        </div>
        <h3 class="font-sf-pro text-[28px] font-light text-white m-0 mb-4 leading-[1.2] md:text-[32px] sm:text-[24px] sm:mb-6 text-center footer-title-text" data-ar="انضم إلى نادينا الحصري" data-en="Join Our Exclusive Club" style="font-family: 'DIN Display', 'DIN Next LT W23', Arial, sans-serif;">
          Join Our Exclusive Club
        </h3>
        <div 
          class="flex rounded-lg overflow-hidden mb-4 mx-auto" 
          style="
            width: 400px; 
            height: 45px; 
            background: rgba(60, 60, 60, 0.49); 
            border: 1px solid rgba(121, 119, 119, 0.56);
            backdrop-filter: none;
            padding-right: 0;
            justify-content: space-between;
            align-items: center;
            align-self: stretch;
            margin: 0 auto;
            padding-bottom: 0;
          "
        >
          <input 
            type="email" 
            class="flex-1 h-full py-3 px-4 font-sf-pro text-sm bg-transparent border-none outline-none newsletter-input" 
            style="
              color: rgba(255, 255, 255, 0.64);
              font-family: SF Pro Display;
              font-size: 14px;
              font-style: normal;
              font-weight: 400;
              line-height: normal;
              text-align: right;
            " 
            placeholder="Enter Email Address"
            data-placeholder-ar="أدخل عنوان البريد الإلكتروني"
            data-placeholder-en="Enter Email Address"
          />
          <button 
            class="h-full py-3 px-6 font-sf-pro text-sm font-medium border-none cursor-pointer transition-all duration-300 newsletter-button" 
            style="
              background: rgba(140, 135, 135, 0.43); 
              color: rgba(255, 255, 255, 1);
              font-family: SF Pro Display;
              font-size: 14px;
              font-style: normal;
              font-weight: 500;
              line-height: normal;
            "
          >
            <span class="newsletter-button-text" data-ar="سجل" data-en="Register">Register</span>
          </button>
        </div>
        <p 
          class="font-sf-pro text-[15px] font-light text-white mt-4 leading-[1.6] max-w-[450px] sm:text-base footer-description-text"
          style="
            color: rgba(255, 255, 255, 0.54);
            text-align: left;
            font-family: SF Pro Display, system-ui, sans-serif;
            font-size: 15px;
            font-style: normal;
            font-weight: 300;
            line-height: 130.231%;
            margin-top: 24px;
            padding-left: 16px;
          "
          data-ar="كعضو، ستتلقى وصولاً مبكراً إلى الإصدارات المحدودة، وعروض خاصة محفوظة فقط للداخلين، ومحتوى منسق مصمم لرفع تجربتك."
          data-en="As a subscriber, you'll receive early access to limited releases, private offers reserved only for insiders, and curated content designed to elevate your experience."
        >
          As a subscriber, you'll receive early access to limited releases, private offers reserved only for insiders, and curated content designed to elevate your experience.
        </p>
      </div>
    </div>
  </section>
  
  <!-- Footer Bottom -->
  <div class="bg-[#000000] h-16 flex items-center">
    <div class="max-w-[1200px] mx-auto px-5 flex justify-between items-center whitespace-nowrap w-full">
      <div class="footer-left">
        <p class="font-sf-pro text-sm font-light text-[#888] m-0 sm:text-xs footer-copyright-text" data-ar="الكانتا - جميع الحقوق محفوظة" data-en="Alcanta - All Rights Reserved">Alcanta - All Rights Reserved</p>
      </div>
      <div class="flex items-center gap-2">
        <div class="bg-white rounded-sm p-2 flex items-center justify-center" style="width: 60px; height: 30px;">
          <img src="{{ 'images/payment/mada.png'|asset }}" alt="Mada" class="max-w-full max-h-full object-contain" />
        </div>
        <div class="bg-white rounded-sm p-2 flex items-center justify-center" style="width: 60px; height: 30px;">
          <img src="{{ 'images/payment/paypal.png'|asset }}" alt="PayPal" class="max-w-full max-h-full object-contain" />
        </div>
        <div class="bg-white rounded-sm p-2 flex items-center justify-center" style="width: 60px; height: 30px;">
          <img src="{{ 'images/payment/mastercard.png'|asset }}" alt="Mastercard" class="max-w-full max-h-full object-contain" />
        </div>
        <div class="bg-white rounded-sm p-2 flex items-center justify-center" style="width: 60px; height: 30px;">
          <img src="{{ 'images/payment/visa.png'|asset }}" alt="Visa" class="max-w-full max-h-full object-contain" />
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
(function() {
  // Prevent multiple script execution
  if (window.footerScriptLoaded) {
    return;
  }
  window.footerScriptLoaded = true;
  
  // Function to update footer text based on language
  window.updateFooterTexts = function(lang = null) {
    // Debug all language sources
    console.log('Footer: Debug - Language sources:');
    console.log('  - lang parameter:', lang);
    console.log('  - URL lang parameter:', new URLSearchParams(window.location.search).get('lang'));
    console.log('  - DOM language:', document.documentElement.lang || document.querySelector('html').getAttribute('lang'));
    console.log('  - localStorage currentLanguage:', localStorage.getItem('currentLanguage'));
    console.log('  - localStorage language:', localStorage.getItem('language'));
    console.log('  - user.language.code:', '{{ user.language.code }}');
    
    // Detect current language - prioritize URL parameter and DOM language over localStorage
    const urlLang = new URLSearchParams(window.location.search).get('lang');
    const domLang = document.documentElement.lang || document.querySelector('html').getAttribute('lang');
    
    const currentLang = lang || 
                       urlLang ||
                       domLang ||
                       localStorage.getItem('currentLanguage') || 
                       localStorage.getItem('language') ||
                       '{{ user.language.code }}' || 
                       'en';
    
    console.log('Footer: Final language detected:', currentLang);
    
    // Update footer title
    const footerTitle = document.querySelector('.footer-title-text');
    if (footerTitle) {
      const text = currentLang === 'ar' ? footerTitle.getAttribute('data-ar') : footerTitle.getAttribute('data-en');
      console.log('Footer: Title update - currentLang:', currentLang, 'text:', text);
      if (text) {
        footerTitle.textContent = text;
        // Apply DIN Display font for Arabic text
        if (currentLang === 'ar') {
          footerTitle.style.fontFamily = "'DIN Display', 'DIN Next LT W23', Arial, sans-serif";
        } else {
          footerTitle.style.fontFamily = "'SF Pro Display', system-ui, sans-serif";
        }
        console.log('Footer: Title updated to:', text);
      }
    } else {
      console.log('Footer: ERROR - footer-title-text element not found');
    }
    
    // Update copyright text
    const copyrightText = document.querySelector('.footer-copyright-text');
    if (copyrightText) {
      const text = currentLang === 'ar' ? copyrightText.getAttribute('data-ar') : copyrightText.getAttribute('data-en');
      if (text) {
        copyrightText.textContent = text;
      }
    }
    
    // Update newsletter input placeholder
    const newsletterInput = document.querySelector('.newsletter-input');
    if (newsletterInput) {
      const placeholder = currentLang === 'ar' ? 
        newsletterInput.getAttribute('data-placeholder-ar') : 
        newsletterInput.getAttribute('data-placeholder-en');
      if (placeholder) {
        newsletterInput.placeholder = placeholder;
      }
      
      // Update text direction and alignment
      newsletterInput.style.direction = currentLang === 'ar' ? 'rtl' : 'ltr';
      newsletterInput.style.textAlign = currentLang === 'ar' ? 'right' : 'left';
    }
    
    // Update newsletter button text
    const buttonText = document.querySelector('.newsletter-button-text');
    if (buttonText) {
      const text = currentLang === 'ar' ? buttonText.getAttribute('data-ar') : buttonText.getAttribute('data-en');
      if (text) {
        buttonText.textContent = text;
      }
    }
    
    // Update footer description text
    const descriptionText = document.querySelector('.footer-description-text');
    if (descriptionText) {
      const text = currentLang === 'ar' ? descriptionText.getAttribute('data-ar') : descriptionText.getAttribute('data-en');
      if (text) {
        descriptionText.textContent = text;
      }
      
      // Update text alignment for description
      descriptionText.style.textAlign = currentLang === 'ar' ? 'right' : 'left';
    }
    
    // Update footer direction
    const footer = document.querySelector('footer');
    if (footer) {
      footer.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
    }
    
    // Update background image based on language
    const footerSection = document.querySelector('footer section');
    if (footerSection) {
      if (currentLang === 'ar') {
        footerSection.style.backgroundImage = 'url("{{ "images/footerar.png"|asset }}")';
        console.log('Footer: Background image updated to Arabic:', '{{ "images/footerar.png"|asset }}');
      } else {
        // For English, use footerBG.png
        footerSection.style.backgroundImage = 'url("{{ "images/footerBG.png"|asset }}")';
        console.log('Footer: Background image updated to English:', '{{ "images/footerBG.png"|asset }}');
      }
    } else {
      console.log('Footer: ERROR - footer section element not found');
    }
    
    // Update content alignment based on language
    const footerContent = document.querySelector('footer .text-center');
    if (footerContent) {
      footerContent.className = currentLang === 'ar' ? 
        'text-center max-w-[500px] ml-auto' : 
        'text-center max-w-[500px] mr-auto';
    }
  };
  
  // Listen for language change events from header
  document.addEventListener('languageChanged', function(event) {
    const newLang = event.detail.to || event.detail.language;
    console.log('Footer: Language change event received:', newLang);
    console.log('Footer: Event details:', event.detail);
    updateFooterTexts(newLang);
  });
  
  // Listen for URL changes (when language changes via URL)
  let currentUrl = window.location.href;
  setInterval(() => {
    if (window.location.href !== currentUrl) {
      console.log('Footer: URL changed, updating language');
      currentUrl = window.location.href;
      updateFooterTexts();
    }
  }, 100);
  
  // Listen for Salla language change events
  if (window.salla && window.salla.event) {
    window.salla.event.on('language::changed', function(data) {
      const lang = data.language || data.code || data;
      console.log('Footer: Salla language change event received:', lang);
      updateFooterTexts(lang);
    });
  }
  
  // Initialize footer on DOM load
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Footer: DOMContentLoaded event fired');
    updateFooterTexts();
  });
  
  // Initialize footer after a short delay
  setTimeout(() => {
    console.log('Footer: Delayed initialization');
    updateFooterTexts();
  }, 200);
  
  // Also initialize immediately
  console.log('Footer: Immediate initialization');
  updateFooterTexts();
  
  // Make the function globally available for manual triggering
  window.updateFooterLanguage = function(lang) {
    console.log('Footer: Manual language update called with:', lang);
    updateFooterTexts(lang);
  };
  
  // Add test buttons to manually switch languages
  console.log('Footer: Adding test buttons for manual language switching');
  setTimeout(() => {
    const testDiv = document.createElement('div');
    testDiv.style.position = 'fixed';
    testDiv.style.top = '10px';
    testDiv.style.right = '10px';
    testDiv.style.zIndex = '9999';
    testDiv.style.background = 'rgba(0,0,0,0.8)';
    testDiv.style.color = 'white';
    testDiv.style.padding = '10px';
    testDiv.style.borderRadius = '5px';
    testDiv.innerHTML = `
      <div>Footer Language Test:</div>
      <button onclick="window.updateFooterLanguage('en')" style="margin: 5px; padding: 5px;">English</button>
      <button onclick="window.updateFooterLanguage('ar')" style="margin: 5px; padding: 5px;">Arabic</button>
    `;
    document.body.appendChild(testDiv);
  }, 1000);
  
})(); // End of footer script scope
</script>
