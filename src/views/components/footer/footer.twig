<footer class="footer bg-[#1a1a1a] text-white" dir="ltr">
  <!-- Newsletter Section -->
  <section
    class="py-8 md:py-6 sm:py-4 relative min-h-[80vh] footer-section overflow-hidden"
  >
    <!-- Background layer so we can mirror only the image without affecting content -->
    <div class="footer-bg absolute inset-0 bg-cover bg-center bg-no-repeat z-0" data-bg="{{ 'images/footerar.png'|asset }}"></div>
    <div class="footer-inner max-w-[1200px] mx-auto px-5 h-full flex items-center justify-center pt-[60px] relative z-10">
      <div class="footer-content max-w-[560px]">
        <div class="mb-2">
          <img
            src="{{ 'assets/images/logo.png'|asset }}"
            alt="Alcanta"
            class="h-12 md:h-14 sm:h-10 footer-logo mx-auto"
          />
        </div>
        <h3
          class="footer-title-text font-sf-pro text-[28px] font-light text-white m-0 mb-4 leading-[1.2] md:text-[32px] sm:text-[24px] sm:mb-6 text-center"
          data-ar="انضم إلى نادينا الحصري"
          data-en="Join Our Exclusive Club"
        >
          Join Our Exclusive Club
        </h3>
        <div
          class="newsletter-form flex rounded-lg overflow-hidden mb-4 w-[420px] max-w-full h-[45px] bg-[rgba(60,60,60,0.49)] border border-[rgba(121,119,119,0.56)] items-center mx-auto"
        >
          <input
            type="email"
            class="newsletter-input flex-1 h-full py-3 px-4 font-sf-pro text-sm bg-transparent outline-none text-white/60"
            placeholder="Enter Email Address"
            data-placeholder-ar="أدخل عنوان البريد الإلكتروني"
            data-placeholder-en="Enter Email Address"
          />
          <button
            class="newsletter-button h-full py-3 px-6 font-sf-pro text-sm font-medium cursor-pointer transition-all duration-300 bg-[rgba(140,135,135,0.43)] text-white"
          >
            <span class="newsletter-button-text" data-ar="سجل" data-en="Register">Register</span>
          </button>
        </div>
        <p
          class="footer-description-text font-sf-pro text-[15px] font-light text-white/60 mt-4 leading-[1.8] max-w-[560px] sm:text-base px-4 mx-auto text-center"
          data-ar="كعضو، ستتلقى وصولاً مبكراً إلى الإصدارات المحدودة، وعروض خاصة محفوظة فقط للداخلين، ومحتوى منسق مصمم لرفع تجربتك."
          data-en="As a subscriber, you'll receive early access to limited releases, private offers reserved only for insiders, and curated content designed to elevate your experience."
        >
          As a subscriber, you'll receive early access to limited releases, private offers reserved only for insiders, and curated content designed to elevate your experience.
        </p>
      </div>
    </div>
  </section>

  <!-- Footer Bottom -->
  <div class="bg-[#000000] h-16 flex items-center">
    <div class="max-w-[1200px] mx-auto px-5 flex justify-between items-center whitespace-nowrap w-full">
      <div class="footer-left">
        <p
          class="font-sf-pro text-sm font-light text-[#888] m-0 sm:text-xs footer-copyright-text"
          data-ar="الكانتا - جميع الحقوق محفوظة"
          data-en="Alcanta - All Rights Reserved"
        >
          Alcanta - All Rights Reserved
        </p>
      </div>
      <div class="payment-methods-container flex items-center gap-1 sm:gap-2 shrink-0">
        <div class="payment-method bg-white rounded-sm p-1 sm:p-2 flex items-center justify-center w-[45px] h-[25px] min-w-[45px] min-h-[25px]">
          <img src="{{ 'images/payment/mada.png'|asset }}" alt="Mada" class="max-w-full max-h-full object-contain" />
        </div>
        <div class="payment-method bg-white rounded-sm p-1 sm:p-2 flex items-center justify-center w-[45px] h-[25px] min-w-[45px] min-h-[25px]">
          <img src="{{ 'images/payment/paypal.png'|asset }}" alt="PayPal" class="max-w-full max-h-full object-contain" />
        </div>
        <div class="payment-method bg-white rounded-sm p-1 sm:p-2 flex items-center justify-center w-[45px] h-[25px] min-w-[45px] min-h-[25px]">
          <img src="{{ 'images/payment/mastercard.png'|asset }}" alt="Mastercard" class="max-w-full max-h-full object-contain" />
        </div>
        <div class="payment-method bg-white rounded-sm p-1 sm:p-2 flex items-center justify-center w-[45px] h-[25px] min-w-[45px] min-h-[25px]">
          <img src="{{ 'images/payment/visa.png'|asset }}" alt="Visa" class="max-w-full max-h-full object-contain" />
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
(function () {
  if (window.footerScriptLoaded) return;
  window.footerScriptLoaded = true;

  // Use the same Arabic background for both languages; mirror for English
  const FOOTER_BG = (document.querySelector('.footer-bg')?.getAttribute('data-bg')) || '{{ "images/footerar.png"|asset }}';

  function detectLanguage(preferred) {
    const urlLang = new URLSearchParams(window.location.search).get('lang');
    const storedLang = localStorage.getItem('currentLanguage');
    const domLang = document.documentElement.lang || document.querySelector('html')?.getAttribute('lang');
    const userLang = '{{ user.language.code }}';
    return (
      preferred ||
      urlLang ||
      userLang ||
      domLang ||
      storedLang ||
      'en'
    );
  }

  function updateFooterTexts(lang) {
    const currentLang = detectLanguage(lang);

    // persist
    if (currentLang && localStorage.getItem('currentLanguage') !== currentLang) {
      localStorage.setItem('currentLanguage', currentLang);
    }

    // dir
    const footer = document.querySelector('footer');
    if (footer) footer.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');

    // title (always centered within the block)
    const footerTitle = document.querySelector('.footer-title-text');
    if (footerTitle) {
      const text = currentLang === 'ar' ? footerTitle.getAttribute('data-ar') : footerTitle.getAttribute('data-en');
      if (text) footerTitle.textContent = text;
      footerTitle.style.fontFamily = currentLang === 'ar'
        ? "'DIN Display', 'DIN Next LT W23', Arial, sans-serif"
        : "'SF Pro Display', system-ui, sans-serif";
      footerTitle.style.textAlign = 'center';
      footerTitle.style.marginLeft = 'auto';
      footerTitle.style.marginRight = 'auto';
    }

    // copyright
    const copyrightText = document.querySelector('.footer-copyright-text');
    if (copyrightText) {
      const text = currentLang === 'ar' ? copyrightText.getAttribute('data-ar') : copyrightText.getAttribute('data-en');
      if (text) copyrightText.textContent = text;
    }

    // newsletter input
    const newsletterInput = document.querySelector('.newsletter-input');
    if (newsletterInput) {
      const placeholder = currentLang === 'ar'
        ? newsletterInput.getAttribute('data-placeholder-ar')
        : newsletterInput.getAttribute('data-placeholder-en');
      if (placeholder) newsletterInput.placeholder = placeholder;
      newsletterInput.style.direction = currentLang === 'ar' ? 'rtl' : 'ltr';
      newsletterInput.style.textAlign = currentLang === 'ar' ? 'right' : 'left';
    }

    // button text
    const buttonText = document.querySelector('.newsletter-button-text');
    if (buttonText) {
      const text = currentLang === 'ar' ? buttonText.getAttribute('data-ar') : buttonText.getAttribute('data-en');
      if (text) buttonText.textContent = text;
    }

    // description
    const descriptionText = document.querySelector('.footer-description-text');
    if (descriptionText) {
      const text = currentLang === 'ar' ? descriptionText.getAttribute('data-ar') : descriptionText.getAttribute('data-en');
      if (text) descriptionText.textContent = text;
      descriptionText.style.textAlign = 'center';
      descriptionText.style.marginLeft = 'auto';
      descriptionText.style.marginRight = 'auto';
    }

    // background image layer with mirroring for English
    const footerBg = document.querySelector('.footer-bg');
    if (footerBg) {
      footerBg.style.backgroundImage = `url('${FOOTER_BG}')`;
      footerBg.style.backgroundSize = 'cover';
      footerBg.style.backgroundPosition = 'center';
      footerBg.style.backgroundRepeat = 'no-repeat';
      footerBg.style.transform = currentLang === 'en' ? 'scaleX(-1)' : 'none';
      footerBg.style.transformOrigin = 'center';
    }

    // alignment: center container; align ALL elements inside to one side
    const footerContent = document.querySelector('.footer-content');
    const footerInner = document.querySelector('.footer-inner');
    const logo = document.querySelector('.footer-logo');
    const form = document.querySelector('.newsletter-form');
    // use previously selected descriptionText
    if (footerInner) {
      footerInner.style.justifyContent = currentLang === 'ar' ? 'flex-end' : 'flex-start';
    }
    if (footerContent) {
      footerContent.style.marginLeft = '0';
      footerContent.style.marginRight = '0';
      footerContent.style.textAlign = 'center';
      // place whole block to a side while keeping internal items centered
      footerContent.style.alignSelf = currentLang === 'ar' ? 'flex-end' : 'flex-start';
    }
    if (logo) {
      logo.style.marginLeft = 'auto';
      logo.style.marginRight = 'auto';
    }

    // swap input/button order in newsletter form based on language
    if (form) {
      form.style.flexDirection = currentLang === 'ar' ? 'row-reverse' : 'row';
      form.style.marginLeft = 'auto';
      form.style.marginRight = 'auto';
    }
  }

  // expose for manual triggering if needed
  window.updateFooterTexts = updateFooterTexts;

  // observe URL changes without polling
  (function setupUrlChangeObserver() {
    const { pushState, replaceState } = history;
    history.pushState = function () {
      const res = pushState.apply(this, arguments);
      window.dispatchEvent(new Event('urlchange'));
      return res;
    };
    history.replaceState = function () {
      const res = replaceState.apply(this, arguments);
      window.dispatchEvent(new Event('urlchange'));
      return res;
    };
    const onUrlChange = () => updateFooterTexts();
    window.addEventListener('popstate', onUrlChange);
    window.addEventListener('hashchange', onUrlChange);
    window.addEventListener('urlchange', onUrlChange);
  })();

  // header event
  document.addEventListener('languageChanged', function (event) {
    const newLang = event.detail?.to || event.detail?.language;
    updateFooterTexts(newLang);
  });

  // Salla events
  if (window.salla && window.salla.event) {
    window.salla.event.on('language::changed', function (data) {
      const lang = data?.language || data?.code || data;
      updateFooterTexts(lang);
    });
  }
  document.addEventListener('salla:language:changed', function (event) {
    const lang = event.detail?.language || event.detail?.code;
    updateFooterTexts(lang);
  });

  // init
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => updateFooterTexts());
  } else {
    updateFooterTexts();
  }
})();
</script>